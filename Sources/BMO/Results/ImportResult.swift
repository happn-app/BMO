/*
Copyright 2019 happn

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. */

import Foundation



public struct ImportResult<DbType : Db> {
	
	/* Note: We deliberately chose not to put the relationship metadata info from
	 * the bridge in this struct. We could have, but it would have made many
	 * other objects required to be generic and in overall complexified the code.
	 * Furthermore, the bridge metadata info do not really have a place here
	 * anyway.
	 *
	 * If we one day absolutely **do** need the metadata directly in the fast
	 * import results, it is however possible to do so. It would be of good taste
	 * to name the type of these Metadata “UserInfo” as is in the
	 * FastImportRepresentation. */
	
	/** The imported objects directly corresponding to the given db
	representations in the request.
	
	Some importers might decide to drop the relationships part of the result for
	performance reasons (hence the optionality of the relationships part of the
	tuple). */
	public let rootObjectsAndRelationships: [(object: DbType.ObjectType, relationships: [String: ImportResult<DbType>]?)]
	
	/** Contains the changes reported by the db import method. Most of the time
	will only contain modifications generated by the method, not the implicit
	modifications (eg. when a relationship value is replaced, all objects
	previously in the relationship are usually modified because the reverse
	relationship will be set to nil).
	
	Some importers might decide to drop this result for performance reasons,
	hence the optionality. */
	public let changes: ChangesDescription<DbType.ObjectIDType>?
	
	public init(rootObjectsAndRelationships r: [(object: DbType.ObjectType, relationships: [String: ImportResult<DbType>]?)], changes c: ChangesDescription<DbType.ObjectIDType>?) {
		rootObjectsAndRelationships = r
		changes = c
	}
	
}
